name: ðŸ› Reproduce Python 3.14.2 x86 Bug

on:
  push:

permissions:
  contents: read

jobs:
  reproduce:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: "3.14"
          architecture: x86
      
      - name: Create multiple test files
        run: |
          # Create 50 test files with Unicode parameters
          for ($i=1; $i -le 500; $i++) {
            @"
          import pytest
          
          @pytest.mark.parametrize('key1,key2', [
              ('\U00010002abc$i', 'abc\u79d8\u5bc6\u4ee3\u7801$i'),
              ('test1_$i', 'test2_$i'),
              ('\U00010002_$i', '\u79d8\u5bc6\u4ee3\u7801-abc\U00010002-\U00010002abc\u79d8\u5bc6\u4ee3\u7801123\U00010002-\u79d8\u5bc6\u4ee3\u7801abc\U00010002'),
          ])
          def test_unicode_params_$i(key1, key2):
              assert len(key1) > 0
              assert len(key2) > 0
              import warnings
              warnings.warn(f'Test warning {key1} {key2}')
          "@ | Out-File -FilePath "test_$i.py" -Encoding utf8
          }
      
      - name: Install pytest
        run: pip install pytest==8.0.0
      
      - name: Run all test files
        run: pytest (Get-ChildItem test_*.py).Name -vv
